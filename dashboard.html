<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Kelola Uang</title>
    <link rel="stylesheet" href="public/css/dashboard-style.css">
</head>

<body>
    <header class="header">
        <img src="public/asset/Logo-Icons.png" alt="Kelola Uang Logo" class="header__logo">
    </header>

    <main class="main-content">
        <div class="tip-container" aria-label="Tip keuangan">
            <p>Tip: Lorem ipsum dolor sit amet consectetur adipisicing elit. Ad nisi cum qui eligendi, itaque pariatur
                voluptatibus praesentium recusandae quos adipisci deserunt perspiciatis porro impedit, id neque vitae
                odio. Nam, alias!</p>
        </div>

        <section class="statistics">
            <div class="stat-card income">
                <div class="stat-card__header">
                    <h3 class="stat-card__title">Pemasukan</h3>
                    <div class="trend up">
                        <span class="material-symbols-outlined">trending_up</span>
                        <span>12%</span>
                    </div>
                </div>
                <div class="stat-card__body">
                    <div class="stat-card__main-value">
                        <p class="stat-card__value"><span id="num3"></span></p>
                        <p class="stat-card__subtext">from 670 (last 30 days)</p>
                    </div>
                    <div class="stat-card__chart">
                        <canvas id="leadChart" class="stat-chart"></canvas>
                    </div>
                </div>
            </div>
            <div class="stat-card expense">
                <div class="stat-card__header">
                    <h3 class="stat-card__title">Pengeluaran</h3>
                    <div class="trend down">
                        <span class="material-symbols-outlined">trending_down</span>
                        <span>5%</span>
                    </div>
                </div>
                <div class="stat-card__body">
                    <div class="stat-card__main-value">
                        <p class="stat-card__value"><span id="num2"></span></p>
                        <p class="stat-card__subtext">from 3.200.000 (last 30 days)</p>
                    </div>
                    <div class="stat-card__chart">
                        <canvas id="expenseChart" class="stat-chart"></canvas>
                    </div>
                </div>
            </div>
            <div class="stat-card balance">
                <div class="stat-card__header">
                    <h3 class="stat-card__title">Total Saldo</h3>
                    <div class="trend up">
                        <span class="material-symbols-outlined">trending_up</span>
                        <span>8%</span>
                    </div>
                </div>
                <div class="stat-card__body">
                    <div class="stat-card__main-value">
                        <p class="stat-card__value"><span id="num1"></span></p>
                        <p class="stat-card__subtext">from 1.850.000 (last 30 days)</p>
                    </div>
                    <div class="stat-card__chart">
                        <canvas id="balanceChart" class="stat-chart"></canvas>
                    </div>
                </div>
            </div>
            <div class="stat-card emergency">
                <div class="stat-card__header">
                    <h3 class="stat-card__title">Dana Darurat</h3>
                    <div class="trend up">
                        <span class="material-symbols-outlined">trending_up</span>
                        <span>5%</span>
                    </div>
                </div>
                <div class="stat-card__body">
                    <div class="stat-card__main-value">
                        <p class="stat-card__value">Rp 2.000.000</p>
                        <p class="stat-card__subtext">dari target 3.000.000</p>
                    </div>
                    <div class="stat-card__chart">
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 65%"></div>
                            </div>
                            <span>65%</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="content-area content-area--01">
            <div class="menu-grid">
                <div class="menu-item" role="button" tabindex="0" aria-label="Tambah pemasukan" onclick="window.location.href='halaman-tujuan.html'">
                    <i class="material-icons menu-icon">account_balance_wallet</i>
                    <span class="menu-name">Pemasukan</span>
                </div>
                <div class="menu-item" role="button" tabindex="0" aria-label="Tambah pengeluaran" onclick="window.location.href='halaman-tujuan.html'">
                    <i class="material-icons menu-icon">payments</i>
                    <span class="menu-name">Pengeluaran</span>
                </div>
                <div class="menu-item" role="button" tabindex="0" aria-label="Pemasukan berulang" onclick="window.location.href='halaman-tujuan.html'">
                    <i class="material-icons menu-icon">autorenew</i>
                    <span class="menu-name">Pemasukan Berulang</span>
                </div>
                <div class="menu-item" role="button" tabindex="0" aria-label="Pengeluaran berulang" onclick="window.location.href='halaman-tujuan.html'">
                    <i class="material-icons menu-icon">repeat</i>
                    <span class="menu-name">Pengeluaran Berulang</span>
                </div>
                <div class="menu-item" role="button" tabindex="0" aria-label="Target keuangan" onclick="window.location.href='halaman-tujuan.html'">
                    <i class="material-icons menu-icon">flag</i>
                    <span class="menu-name">Target</span>
                </div>
                <div class="menu-item" role="button" tabindex="0" aria-label="Dana darurat" onclick="window.location.href='halaman-tujuan.html'">
                    <i class="material-icons menu-icon">emergency</i>
                    <span class="menu-name">Dana Darurat</span>
                </div>
                <div class="menu-item" role="button" tabindex="0" aria-label="Laporan keuangan" onclick="window.location.href='halaman-tujuan.html'">
                    <i class="material-icons menu-icon">bar_chart</i>
                    <span class="menu-name">Laporan</span>
                </div>
            </div>

            <div class="content-wrapper">
                <div class="transactions-section">
                    <div class="transactions">
                        <h2 class="section-title">Transaksi Terakhir</h2>
                        <div class="transaction-card">
                            <div class="transaction-info">
                                <div class="category-icon food">
                                    <span class="material-icons">restaurant</span>
                                </div>
                                <div class="transaction-details">
                                    <p class="transaction-category">Makanan</p>
                                    <p class="transaction-time">Hari ini, 14:30</p>
                                </div>
                            </div>
                            <p class="transaction-amount expense">Rp. 500.000</p>
                        </div>
                        <div class="transaction-card">
                            <div class="transaction-info">
                                <div class="category-icon salary">
                                    <span class="material-icons">payments</span>
                                </div>
                                <div class="transaction-details">
                                    <p class="transaction-category">Gaji</p>
                                    <p class="transaction-time">Kemarin, 09:15</p>
                                </div>
                            </div>
                            <p class="transaction-amount income">Rp. 5.000.000</p>
                        </div>
                        <div class="transaction-card">
                            <div class="transaction-info">
                                <div class="category-icon transport">
                                    <span class="material-icons">directions_car</span>
                                </div>
                                <div class="transaction-details">
                                    <p class="transaction-category">Transport</p>
                                    <p class="transaction-time">15 Mei, 17:45</p>
                                </div>
                            </div>
                            <p class="transaction-amount expense">Rp. 150.000</p>
                        </div>
                    </div>
                </div>

                <div class="transactions-section">
                    <div class="transactions" style="border-width: 1px 0px 1px 0px;">
                        <h2 class="section-title">Pengeluaran Terbesar</h2>
                        <div class="transaction-card">
                            <div class="transaction-info">
                                <div class="category-icon shopping">
                                    <i class="material-icons">shopping_cart</i>
                                </div>
                                <div class="transaction-details">
                                    <p class="transaction-category">Belanja Bulanan</p>
                                </div>
                            </div>
                            <p class="transaction-amount expense">Rp 1.200.000</p>
                        </div>
                        <div class="transaction-card">
                            <div class="transaction-info">
                                <div class="category-icon food">
                                    <i class="material-icons">house</i>
                                </div>
                                <div class="transaction-details">
                                    <p class="transaction-category">Sewa Rumah</p>
                                </div>
                            </div>
                            <p class="transaction-amount expense">Rp 1.000.000</p>
                        </div>
                        <div class="transaction-card">
                            <div class="transaction-info">
                                <div class="category-icon transport">
                                    <i class="material-icons">two_wheeler</i>
                                </div>
                                <div class="transaction-details">
                                    <p class="transaction-category">Angsuran Motor</p>
                                </div>
                            </div>
                            <p class="transaction-amount expense">Rp 800.000</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="content-area content-area--02">
            <div class="chart-section">
                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-header__title">
                            <h3>Transaksi</h3>
                            <p>Pemasukan dan Pengeluaran</p>
                        </div>
                        <div class="chart-filter">
                            <button class="filter-btn" data-range="7days">7 Hari</button>
                            <button class="filter-btn active" data-range="30days">30 Hari</button>
                            <button class="filter-btn" data-range="3months">3 Bulan</button>
                            <button class="filter-btn" data-range="6months">6 Bulan</button>
                            <button class="filter-btn" data-range="1year">1 Tahun</button>
                        </div>
                    </div>
                    <div class="chart-container-wrapper">
                        <div class="chart-labels">
                            <div class="chart-label">
                                <div class="chart-label-dot income"></div>
                                <span class="chart-label-text">Pemasukan</span>
                            </div>
                            <div class="chart-label">
                                <div class="chart-label-dot expense"></div>
                                <span class="chart-label-text">Pengeluaran</span>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="combinedChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.5.0/chart.umd.min.js" crossorigin="anonymous"
        referrerpolicy="no-referrer"></script>
    <script src="public/js/format-helper.js"></script>
    <script>
        function initmain() {
            // Isi angka HTML setelah DOM siap
            const el1 = document.getElementById("num1");
            const el2 = document.getElementById("num2");
            const el3 = document.getElementById("num3");
            if (el1) el1.textContent = formatNumber(2000000); // Total Saldo
            if (el2) el2.textContent = formatNumber(3000000); // Pengeluaran
            if (el3) el3.textContent = formatNumber(5000000); // Pemasukan

            // Data untuk chart 7 hari terakhir
            const data7Days = {
                labels: ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'],
                datasets: [
                    { 
                        label: 'Pemasukan', 
                        data: [5, 10, 8, 12, 15, 7, 9], 
                        borderColor: 'rgba(31, 119, 180, 1)',
                        backgroundColor: 'rgba(31, 119, 180, 0.6)',
                        borderWidth: 2,
                        borderRadius: 4,
                        borderSkipped: false,
                        fill: true,
                        tension: 0.4
                    },
                    { 
                        label: 'Pengeluaran', 
                        data: [3, 7, 10, 5, 8, 12, 6], 
                        borderColor: 'rgba(255, 127, 14, 1)',
                        backgroundColor: 'rgba(255, 127, 14, 0.6)',
                        borderWidth: 2,
                        borderRadius: 4,
                        borderSkipped: false,
                        fill: true,
                        tension: 0.4
                    }
                ]
            };

            // Data untuk chart 30 hari terakhir
            const data30Days = {
                labels: ['Minggu 1', 'Minggu 2', 'Minggu 3', 'Minggu 4'],
                datasets: [
                    { 
                        label: 'Pemasukan', 
                        data: [10, 20, 30, 15], 
                        borderColor: 'rgba(31, 119, 180, 1)',
                        backgroundColor: 'rgba(31, 119, 180, 0.6)',
                        borderWidth: 2,
                        borderRadius: 4,
                        borderSkipped: false,
                        fill: true,
                        tension: 0.4
                    },
                    { 
                        label: 'Pengeluaran', 
                        data: [5, 25, 15, 10], 
                        borderColor: 'rgba(255, 127, 14, 1)',
                        backgroundColor: 'rgba(255, 127, 14, 0.6)',
                        borderWidth: 2,
                        borderRadius: 4,
                        borderSkipped: false,
                        fill: true,
                        tension: 0.4
                    }
                ]
            };

            // Data untuk chart 3 bulan terakhir
            const data3Months = {
                labels: ['Januari', 'Februari', 'Maret'],
                datasets: [
                    { 
                        label: 'Pemasukan', 
                        data: [1500, 1800, 2000], 
                        borderColor: 'rgba(31, 119, 180, 1)',
                        backgroundColor: 'rgba(31, 119, 180, 0.6)',
                        borderWidth: 2,
                        borderRadius: 4,
                        borderSkipped: false,
                        fill: true,
                        tension: 0.4
                    },
                    { 
                        label: 'Pengeluaran', 
                        data: [1000, 1200, 1500], 
                        borderColor: 'rgba(255, 127, 14, 1)',
                        backgroundColor: 'rgba(255, 127, 14, 0.6)',
                        borderWidth: 2,
                        borderRadius: 4,
                        borderSkipped: false,
                        fill: true,
                        tension: 0.4
                    }
                ]
            };

            // Data untuk chart 6 bulan terakhir
            const data6Months = {
                labels: ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni'],
                datasets: [
                    { 
                        label: 'Pemasukan', 
                        data: [500, 700, 800, 600, 900, 750], 
                        borderColor: 'rgba(31, 119, 180, 1)',
                        backgroundColor: 'rgba(31, 119, 180, 0.6)',
                        borderWidth: 2,
                        borderRadius: 4,
                        borderSkipped: false,
                        fill: true,
                        tension: 0.4
                    },
                    { 
                        label: 'Pengeluaran', 
                        data: [300, 400, 500, 450, 600, 550], 
                        borderColor: 'rgba(255, 127, 14, 1)',
                        backgroundColor: 'rgba(255, 127, 14, 0.6)',
                        borderWidth: 2,
                        borderRadius: 4,
                        borderSkipped: false,
                        fill: true,
                        tension: 0.4
                    }
                ]
            };

            // Data untuk chart 1 tahun terakhir
            const data1Year = {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'],
                datasets: [
                    { 
                        label: 'Pemasukan', 
                        data: [4000, 4500, 5000, 4800, 5200, 5500, 5800, 6000, 6200, 6500, 7000, 7500], 
                        borderColor: 'rgba(31, 119, 180, 1)',
                        backgroundColor: 'rgba(31, 119, 180, 0.6)',
                        borderWidth: 2,
                        borderRadius: 4,
                        borderSkipped: false,
                        fill: true,
                        tension: 0.4
                    },
                    { 
                        label: 'Pengeluaran', 
                        data: [3000, 3200, 3500, 3400, 3600, 3800, 4000, 4200, 4300, 4500, 4800, 5000], 
                        borderColor: 'rgba(255, 127, 14, 1)',
                        backgroundColor: 'rgba(255, 127, 14, 0.6)',
                        borderWidth: 2,
                        borderRadius: 4,
                        borderSkipped: false,
                        fill: true,
                        tension: 0.4
                    }
                ]
            };

            // Konfigurasi chart
            const chartConfig = {
                type: 'bar',
                data: data30Days,
                options: withFormattedAxes({
                    plugins: { 
                        legend: { display: false } 
                    },
                    elements: { 
                        bar: {
                            borderRadius: 4,
                            borderSkipped: false
                        },
                        line: { 
                            tension: 0.4 
                        } 
                    },
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            grid: { display: true },
                            border: { display: true }
                        },
                        y: {
                            grid: { display: true },
                            border: { display: true }
                        }
                    }
                })
            };

            // Inisialisasi chart
            const combinedChartCtx = document.getElementById('combinedChart').getContext('2d');
            const combinedChart = new Chart(combinedChartCtx, chartConfig);

            // Fungsi untuk mengganti data chart berdasarkan filter
            function updateChart(range) {
                switch(range) {
                    case '7days':
                        combinedChart.data = data7Days;
                        combinedChart.options.scales.x.title = { display: true, text: 'Hari' };
                        break;
                    case '30days':
                        combinedChart.data = data30Days;
                        combinedChart.options.scales.x.title = { display: true, text: 'Minggu' };
                        break;
                    case '3months':
                        combinedChart.data = data3Months;
                        combinedChart.options.scales.x.title = { display: true, text: 'Bulan' };
                        break;
                    case '6months':
                        combinedChart.data = data6Months;
                        combinedChart.options.scales.x.title = { display: true, text: 'Bulan' };
                        break;
                    case '1year':
                        combinedChart.data = data1Year;
                        combinedChart.options.scales.x.title = { display: true, text: 'Bulan' };
                        break;
                    default:
                        combinedChart.data = data30Days;
                        combinedChart.options.scales.x.title = { display: true, text: 'Minggu' };
                }
                combinedChart.update();
            }

            // Event listener untuk filter button
            document.querySelectorAll('.filter-btn').forEach(button => {
                button.addEventListener('click', function() {
                    // Update active button
                    document.querySelectorAll('.filter-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Update chart
                    const range = this.getAttribute('data-range');
                    updateChart(range);
                });
            });

            // Chart Pemasukan
            const ctx = document.getElementById('leadChart').getContext('2d');
            // gradient hijau -> transparan
            const gradient = ctx.createLinearGradient(0, 0, 0, 60);
            gradient.addColorStop(0, 'rgba(34, 197, 94, 0.4)');
            gradient.addColorStop(1, 'rgba(34, 197, 94, 0)');

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({ length: 30 }, (_, i) => i + 1),
                    datasets: [{
                        data: [987, 1000, 1100, 1250, 1300, 1500, 1600, 1550, 1700, 1800, 1900, 2000, 2245],
                        borderColor: '#22c55e',
                        borderWidth: 2,
                        backgroundColor: gradient,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        clip: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: { padding: 0 },
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false } // tooltip dinonaktifkan (kalau mau aktif, ganti menjadi true)
                    },
                    scales: {
                        x: { display: false, min: 0, max: 12 },
                        y: { display: false }
                    }
                }
            });

            // Chart Pengeluaran
            const ctx2 = document.getElementById('expenseChart').getContext('2d');
            // gradient merah -> transparan
            const gradient2 = ctx2.createLinearGradient(0, 0, 0, 60);
            gradient2.addColorStop(0, 'rgba(239, 68, 68, 0.4)');
            gradient2.addColorStop(1, 'rgba(239, 68, 68, 0)');

            new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: Array.from({ length: 30 }, (_, i) => i + 1),
                    datasets: [{
                        data: [1200, 1150, 1300, 1250, 1400, 1350, 1500, 1450, 1600, 1550, 1700, 1650, 1800],
                        borderColor: '#ef4444',
                        borderWidth: 2,
                        backgroundColor: gradient2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        clip: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: { padding: 0 },
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    },
                    scales: {
                        x: { display: false, min: 0, max: 12 },
                        y: { display: false }
                    }
                }
            });

            // Chart Saldo
            const ctx3 = document.getElementById('balanceChart').getContext('2d');
            // gradient biru -> transparan
            const gradient3 = ctx3.createLinearGradient(0, 0, 0, 60);
            gradient3.addColorStop(0, 'rgba(59, 130, 246, 0.4)');
            gradient3.addColorStop(1, 'rgba(59, 130, 246, 0)');

            new Chart(ctx3, {
                type: 'line',
                data: {
                    labels: Array.from({ length: 30 }, (_, i) => i + 1),
                    datasets: [{
                        data: [800, 850, 900, 950, 1000, 1050, 1100, 1150, 1200, 1250, 1300, 1350, 1400],
                        borderColor: '#3b82f6',
                        borderWidth: 2,
                        backgroundColor: gradient3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        clip: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: { padding: 0 },
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    },
                    scales: {
                        x: { display: false, min: 0, max: 12 },
                        y: { display: false }
                    }
                }
            });

            console.log('Charts initialized with data');
        }

        document.addEventListener('DOMContentLoaded', initmain);
    </script>

</body>

</html>